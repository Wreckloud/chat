<!--ç¾¤ç»„è¯¦æƒ…é¡µé¢-->
<view class="container">
  <!-- é¡¶éƒ¨ç¾¤ä¿¡æ¯å¡ç‰‡ -->
  <view class="group-card">
    <view class="group-header">
      <image class="group-avatar" src="{{ group.groupAvatar || '/images/default-group.png' }}" mode="aspectFill"></image>
      <view class="group-info">
        <view class="group-name-row">
          <text class="group-name">{{ group.groupName }}</text>
          <van-tag type="primary" wx:if="{{ myRole === 'OWNER' }}">ç¾¤ä¸»</van-tag>
          <van-tag type="success" wx:if="{{ myRole === 'ADMIN' }}">ç®¡ç†å‘˜</van-tag>
        </view>
        <text class="group-desc" wx:if="{{ group.groupIntro }}">{{ group.groupIntro }}</text>
        <text class="member-count">æˆå‘˜: {{ group.memberCount }}/{{ group.maxMembers }}</text>
      </view>
    </view>
  </view>

  <!-- æˆå‘˜åˆ—è¡¨ -->
  <view class="member-section">
    <view class="section-header">
      <text class="section-title">æˆå‘˜åˆ—è¡¨ ğŸº</text>
      <van-button 
        size="small" 
        type="primary" 
        icon="plus"
        bind:click="showInviteDialog"
      >
        é‚€è¯·
      </van-button>
    </view>

    <view class="member-list">
      <view 
        class="member-item" 
        wx:for="{{ members }}" 
        wx:key="userId"
        bindlongpress="showMemberActions"
        data-member="{{ item }}"
      >
        <image class="member-avatar" src="{{ item.avatar || '/images/default-avatar.png' }}" mode="aspectFill"></image>
        <view class="member-info">
          <view class="member-name-row">
            <text class="member-name">{{ item.groupNickname || item.username }}</text>
            <van-tag size="medium" type="danger" wx:if="{{ item.role === 'OWNER' }}">ç¾¤ä¸»</van-tag>
            <van-tag size="medium" type="success" wx:if="{{ item.role === 'ADMIN' }}">ç®¡ç†</van-tag>
          </view>
          <text class="member-wf-no">WF{{ item.wfNo }}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒº -->
  <view class="action-section">
    <van-cell-group>
      <van-cell title="ä¿®æ”¹æˆ‘çš„ç¾¤æ˜µç§°" is-link icon="edit" bind:click="showNicknameDialog" />
      <van-cell 
        title="ç¾¤å…¬å‘Š" 
        is-link 
        icon="comment-o"
        label="{{ latestNotice }}"
        bind:click="showNoticeList" 
      />
      <van-cell title="ç¾¤è®¾ç½®" is-link icon="setting-o" bind:click="showGroupSetting" wx:if="{{ myRole === 'OWNER' || myRole === 'ADMIN' }}" />
      <van-cell title="é€€å‡ºç¾¤ç»„" icon="sign-o" bind:click="quitGroup" wx:if="{{ myRole !== 'OWNER' }}" />
      <van-cell title="è§£æ•£ç¾¤ç»„" icon="delete-o" bind:click="disbandGroup" wx:if="{{ myRole === 'OWNER' }}" />
    </van-cell-group>
  </view>
</view>

<!-- é‚€è¯·æˆå‘˜å¼¹çª— -->
<van-dialog
  use-slot
  title="é‚€è¯·æˆå‘˜"
  show="{{ showInvite }}"
  confirm-button-text="é‚€è¯·"
  cancel-button-text="å–æ¶ˆ"
  bind:confirm="inviteMembers"
  bind:cancel="closeInviteDialog"
>
  <van-field
    value="{{ inviteInput }}"
    placeholder="è¯·è¾“å…¥WFå·"
    type="number"
    bind:change="onInviteInputChange"
  />
</van-dialog>

<!-- ä¿®æ”¹ç¾¤æ˜µç§°å¼¹çª— -->
<van-dialog
  use-slot
  title="ä¿®æ”¹ç¾¤æ˜µç§°"
  show="{{ showNickname }}"
  confirm-button-text="ç¡®å®š"
  cancel-button-text="å–æ¶ˆ"
  bind:confirm="updateNickname"
  bind:cancel="closeNicknameDialog"
>
  <van-field
    value="{{ nicknameInput }}"
    placeholder="è¯·è¾“å…¥ç¾¤æ˜µç§°"
    maxlength="20"
    bind:change="onNicknameInputChange"
  />
</van-dialog>

<!-- ç¾¤è®¾ç½®å¼¹çª— -->
<van-action-sheet
  show="{{ showSetting }}"
  actions="{{ settingActions }}"
  bind:select="onSettingSelect"
  bind:close="closeGroupSetting"
/>

<!-- æˆå‘˜æ“ä½œèœå• -->
<van-action-sheet
  show="{{ showMemberAction }}"
  actions="{{ memberActions }}"
  bind:select="onMemberActionSelect"
  bind:close="closeMemberActions"
/>

<!-- å‘å¸ƒå…¬å‘Šå¼¹çª— -->
<van-dialog
  use-slot
  title="å‘å¸ƒç¾¤å…¬å‘Š"
  show="{{ showPublishNotice }}"
  confirm-button-text="å‘å¸ƒ"
  cancel-button-text="å–æ¶ˆ"
  bind:confirm="publishNotice"
  bind:cancel="closePublishNoticeDialog"
>
  <van-field
    value="{{ noticeContent }}"
    type="textarea"
    placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹"
    maxlength="500"
    autosize
    show-word-limit
    bind:change="onNoticeContentChange"
  />
  <van-cell-group>
    <van-cell title="ç½®é¡¶å…¬å‘Š" center>
      <van-switch 
        checked="{{ isNoticePinned }}" 
        bind:change="onNoticePinnedChange"
        size="20px"
      />
    </van-cell>
  </van-cell-group>
</van-dialog>

<!-- Loading -->
<van-toast id="van-toast" />

